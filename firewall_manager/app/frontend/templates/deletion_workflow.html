<div class="container is-fluid">
  <h1 class="title is-5 mb-4">정책 삭제 워크플로우</h1>
  
  <!-- 장비 선택 -->
  <div class="box mb-4">
    <div class="field">
      <label class="label">장비 선택</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select id="device-select">
            <option value="">장비를 선택하세요</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- 워크플로우 상태 -->
  <div class="box mb-4" id="workflow-status-box" style="display: none;">
    <div class="level is-mobile">
      <div class="level-left">
        <div class="level-item">
          <div>
            <p class="heading">상태</p>
            <p class="title is-6" id="workflow-status">-</p>
          </div>
        </div>
        <div class="level-item">
          <div>
            <p class="heading">현재 단계</p>
            <p class="title is-6" id="current-step">-</p>
          </div>
        </div>
      </div>
      <div class="level-right">
        <div class="level-item">
          <button class="button is-small is-primary" id="btn-start-workflow">워크플로우 시작</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 체크리스트 -->
  <div class="box" id="workflow-checklist-box" style="display: none;">
    <h2 class="subtitle is-6 mb-4">워크플로우 단계</h2>
    
    <div id="workflow-steps">
      <!-- Step 1 -->
      <div class="box mb-3 step-item" data-step="1">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="1" disabled>
                <span class="ml-2"><strong>Step 1:</strong> 신청정보 파싱</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-1-status">대기</span>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="1">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="1" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">정책 description에서 신청정보를 파싱합니다.</p>
      </div>

      <!-- Step 2 -->
      <div class="box mb-3 step-item" data-step="2">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="2" disabled>
                <span class="ml-2"><strong>Step 2:</strong> Request ID 추출</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-2-status">대기</span>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="2">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="2" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">Request Type과 Request ID를 추출하여 중복제거합니다.</p>
      </div>

      <!-- Step 3 -->
      <div class="box mb-3 step-item" data-step="3">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="3" disabled>
                <span class="ml-2"><strong>Step 3:</strong> MIS ID 업데이트</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-3-status">대기</span>
              <div class="file is-small">
                <label class="file-label">
                  <input class="file-input" type="file" id="file-mis-id" accept=".csv" />
                  <span class="file-cta">
                    <span class="file-label" id="file-mis-id-label">CSV 선택</span>
                  </span>
                </label>
              </div>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="3">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="3" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">CSV 파일에서 MIS ID를 읽어서 마스터 파일을 업데이트합니다.</p>
      </div>

      <!-- Step 4 -->
      <div class="box mb-3 step-item" data-step="4">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="4" disabled>
                <span class="ml-2"><strong>Step 4:</strong> 신청정보 가공</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-4-status">대기</span>
              <div class="file is-small">
                <label class="file-label">
                  <input class="file-input" type="file" id="file-application-info" accept=".xlsx,.xls" />
                  <span class="file-cta">
                    <span class="file-label" id="file-application-info-label">엑셀 선택</span>
                  </span>
                </label>
              </div>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="4">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="4" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">외부에서 받은 신청정보 엑셀 파일을 가공합니다.</p>
      </div>

      <!-- Step 5 -->
      <div class="box mb-3 step-item" data-step="5">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="5" disabled>
                <span class="ml-2"><strong>Step 5:</strong> 신청정보 매핑</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-5-status">대기</span>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="5">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="5" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">정책과 신청건을 매핑하여 신청정보를 추가합니다.</p>
      </div>

      <!-- Step 6 -->
      <div class="box mb-3 step-item" data-step="6">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="6" disabled>
                <span class="ml-2"><strong>Step 6:</strong> 예외처리</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-6-status">대기</span>
              <div class="select is-small">
                <select id="vendor-select">
                  <option value="paloalto">Palo Alto</option>
                  <option value="secui">SECUI</option>
                </select>
              </div>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="6">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="6" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">예외 정책을 분류합니다.</p>
      </div>

      <!-- Step 7 -->
      <div class="box mb-3 step-item" data-step="7">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <label class="checkbox">
                <input type="checkbox" class="step-checkbox" data-step="7" disabled>
                <span class="ml-2"><strong>Step 7:</strong> 중복정책 분류</span>
              </label>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag" id="step-7-status">대기</span>
              <div class="file is-small">
                <label class="file-label">
                  <input class="file-input" type="file" id="file-redundancy" accept=".xlsx,.xls" />
                  <span class="file-cta">
                    <span class="file-label" id="file-redundancy-label">중복정책 분석 결과</span>
                  </span>
                </label>
              </div>
              <button class="button is-small is-primary ml-2 step-execute-btn" data-step="7">실행</button>
              <button class="button is-small ml-2 step-download-btn" data-step="7" style="display: none;">다운로드</button>
            </div>
          </div>
        </div>
        <p class="help mt-2">중복정책 분석 결과와 신청정보를 결합하여 공지용/삭제용으로 분류합니다.</p>
      </div>
    </div>
  </div>

  <!-- 파일 다운로드 영역 -->
  <div class="box" id="download-box" style="display: none;">
    <h2 class="subtitle is-6 mb-4">파일 다운로드</h2>
    <div class="buttons">
      <button class="button is-small" id="btn-download-master">마스터 파일</button>
      <button class="button is-small is-success" id="btn-export-final">최종 결과 생성</button>
      <button class="button is-small is-success" id="btn-download-final" style="display: none;">최종 결과 다운로드 (ZIP)</button>
    </div>
  </div>

  <!-- 메시지 컨테이너 -->
  <div id="workflow-message-container"></div>
</div>

